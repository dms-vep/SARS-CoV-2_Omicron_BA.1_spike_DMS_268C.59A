
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Probabilities of escape and neutralization in antibody selections &#8212; Deep mutational scanning of SARS-CoV-2 Omicron BA.1 spike and mapping of escape mutations for C68.59 antibody  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Fit polyclonal models" href="fit_polyclonal.html" />
    <link rel="prev" title="Functional effects of mutations averaged across replicates" href="avg_muteffects.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Probabilities-of-escape-and-neutralization-in-antibody-selections">
<h1>Probabilities of escape and neutralization in antibody selections<a class="headerlink" href="#Probabilities-of-escape-and-neutralization-in-antibody-selections" title="Permalink to this headline">Â¶</a></h1>
<p>This notebook analyzes the probabilities of escape and neutralization in antibody selections.</p>
<p>Import Python modules:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>

<span class="kn">import</span> <span class="nn">dms_variants.codonvarianttable</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">yaml</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># allow more rows for Altair</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">data_transformers</span><span class="o">.</span><span class="n">disable_max_rows</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Get configuration information:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you are running notebook interactively rather than in pipeline that handles</span>
<span class="c1"># working directories, you may have to first `os.chdir` to appropriate directory.</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Read-the-escape-probabilities-and-neutralization-information">
<h2>Read the escape probabilities and neutralization information<a class="headerlink" href="#Read-the-escape-probabilities-and-neutralization-information" title="Permalink to this headline">Â¶</a></h2>
<p>Get the antibody selections data frame:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">antibody_selections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;antibody_selections&quot;</span><span class="p">],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;antibody&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Read in the probabilities of escape and neutralization information:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">selection_groups</span> <span class="o">=</span> <span class="n">antibody_selections</span><span class="p">[</span><span class="s2">&quot;selection_group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="n">prob_escape</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">config</span><span class="p">[</span><span class="s2">&quot;prob_escape_dir&quot;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selection_group</span><span class="si">}</span><span class="s2">_prob_escape.csv&quot;</span>
            <span class="p">),</span>
            <span class="n">keep_default_na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">na_values</span><span class="o">=</span><span class="s2">&quot;nan&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">selection_group</span> <span class="ow">in</span> <span class="n">selection_groups</span>
    <span class="p">],</span>
    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">neut_standard_fracs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">config</span><span class="p">[</span><span class="s2">&quot;prob_escape_dir&quot;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selection_group</span><span class="si">}</span><span class="s2">_neut_standard_fracs.csv&quot;</span>
            <span class="p">),</span>
            <span class="n">na_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;antibody&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">selection_group</span> <span class="ow">in</span> <span class="n">selection_groups</span>
    <span class="p">],</span>
    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">antibody_selections</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;antibody_concentration&quot;</span><span class="p">),</span>  <span class="c1"># can be rounding</span>
    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="n">validate</span><span class="o">=</span><span class="s2">&quot;one_to_one&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">neut_standard_fracs</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="n">neutralization</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">config</span><span class="p">[</span><span class="s2">&quot;prob_escape_dir&quot;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selection_group</span><span class="si">}</span><span class="s2">_neutralization.csv&quot;</span>
            <span class="p">),</span>
            <span class="n">na_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">selection_group</span> <span class="ow">in</span> <span class="n">selection_groups</span>
    <span class="p">],</span>
    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># sample order for plotting</span>
<span class="n">sample_order</span> <span class="o">=</span> <span class="n">antibody_selections</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;library&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;virus_batch&quot;</span><span class="p">,</span>
        <span class="s2">&quot;antibody&quot;</span><span class="p">,</span>
        <span class="s2">&quot;replicate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;antibody_concentration&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)[</span><span class="s2">&quot;antibody_library_sample&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Fraction-of-barcode-counts-for-neutralization-standard">
<h2>Fraction of barcode counts for neutralization standard<a class="headerlink" href="#Fraction-of-barcode-counts-for-neutralization-standard" title="Permalink to this headline">Â¶</a></h2>
<p>Make an interactive plot showing this fraction of counts that are neutralization standard for each antibody sample and its no-antibody control. Note the fractions are plotted on a symlog scale:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make tidy version of neut_standard_fracs</span>
<span class="n">melt_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;antibody_frac&quot;</span><span class="p">,</span> <span class="s2">&quot;no-antibody_frac&quot;</span><span class="p">]</span>
<span class="n">neut_standard_fracs_tidy</span> <span class="o">=</span> <span class="n">neut_standard_fracs</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
    <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">neut_standard_fracs</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">melt_cols</span><span class="p">],</span>
    <span class="n">value_vars</span><span class="o">=</span><span class="n">melt_cols</span><span class="p">,</span>
    <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;neut_standard_frac&quot;</span><span class="p">,</span>
    <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;sample_type&quot;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">sample_type</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;sample_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_frac&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
    <span class="n">library_sample</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;antibody_sample&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># set up selections over other columns of interest</span>
<span class="n">selection_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;antibody&quot;</span><span class="p">,</span> <span class="s2">&quot;virus_batch&quot;</span><span class="p">]</span>
<span class="n">selections</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>
        <span class="n">bind</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">binding_select</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">neut_standard_fracs_tidy</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">neut_standard_fracs_tidy</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()],</span>
            <span class="n">name</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">selection_names</span>
<span class="p">]</span>

<span class="n">neut_standard_fracs_chart</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">neut_standard_fracs_tidy</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
            <span class="s2">&quot;neut_standard_frac&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;neutralization standard fraction&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;symlog&quot;</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">domainMax</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;library_sample&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">sample_order</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;sample_type&quot;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;sample_type&quot;</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2g&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;neut_standard_frac&quot;</span> <span class="k">else</span> <span class="n">c</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">neut_standard_fracs_tidy</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="s2">&quot;library_sample&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">mark_point</span><span class="p">()</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">275</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="o">*</span><span class="n">selections</span><span class="p">)</span>
    <span class="o">.</span><span class="n">configure_axis</span><span class="p">(</span><span class="n">labelLimit</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">selection</span> <span class="ow">in</span> <span class="n">selections</span><span class="p">:</span>
    <span class="n">neut_standard_fracs_chart</span> <span class="o">=</span> <span class="n">neut_standard_fracs_chart</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

<span class="n">neut_standard_fracs_chart</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/fh/fast/bloom_j/computational_notebooks/bdadonai/2022/vep_dms/SARS-CoV-2_Omicron_BA.1_spike_DMS_268C.59A/.snakemake/conda/bc6cf8719714f906f2c5affd1f05c658/lib/python3.9/site-packages/altair/utils/core.py:317: FutureWarning: iteritems is deprecated and will be removed in a future version. Use .items instead.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div id="altair-viz-3e5819f0495c4bb3b4b5228c3a835580"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-3e5819f0495c4bb3b4b5228c3a835580") {
      outputDiv = document.getElementById("altair-viz-3e5819f0495c4bb3b4b5228c3a835580");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}, "axis": {"labelLimit": 500}}, "data": {"name": "data-20991e343d6ea58a102bf887216eb0f2"}, "mark": "point", "encoding": {"color": {"field": "sample_type", "type": "nominal"}, "shape": {"field": "sample_type", "type": "nominal"}, "tooltip": [{"field": "library", "type": "nominal"}, {"field": "antibody_sample", "type": "nominal"}, {"field": "no-antibody_sample", "type": "nominal"}, {"field": "antibody", "type": "nominal"}, {"field": "antibody_concentration", "type": "quantitative"}, {"field": "antibody_count", "type": "quantitative"}, {"field": "no-antibody_count", "type": "quantitative"}, {"field": "virus_batch", "type": "nominal"}, {"field": "date", "type": "nominal"}, {"field": "replicate", "type": "quantitative"}, {"field": "selection_group", "type": "nominal"}, {"field": "sample_type", "type": "nominal"}, {"field": "neut_standard_frac", "format": ".2g", "type": "quantitative"}], "x": {"field": "neut_standard_frac", "scale": {"constant": 0.02, "domainMax": 1, "type": "symlog"}, "title": "neutralization standard fraction", "type": "quantitative"}, "y": {"field": "library_sample", "sort": ["Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1"], "title": null, "type": "nominal"}}, "height": {"step": 14}, "params": [{"name": "parameter001", "select": {"type": "point", "fields": ["library"]}, "bind": {"input": "select", "options": [null, "Lib-2", "Lib-3"], "labels": ["all", "Lib-2", "Lib-3"], "name": "library"}}, {"name": "parameter002", "select": {"type": "point", "fields": ["date"]}, "bind": {"input": "select", "options": [null, "2022-06-22"], "labels": ["all", "2022-06-22"], "name": "date"}}, {"name": "parameter003", "select": {"type": "point", "fields": ["antibody"]}, "bind": {"input": "select", "options": [null, "C68.59"], "labels": ["all", "C68.59"], "name": "antibody"}}, {"name": "parameter004", "select": {"type": "point", "fields": ["virus_batch"]}, "bind": {"input": "select", "options": [null, "thaw-1"], "labels": ["all", "thaw-1"], "name": "virus_batch"}}], "transform": [{"filter": {"param": "parameter001"}}, {"filter": {"param": "parameter002"}}, {"filter": {"param": "parameter003"}}, {"filter": {"param": "parameter004"}}], "width": 275, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-20991e343d6ea58a102bf887216eb0f2": [{"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "antibody": "C68.59", "antibody_concentration": 80.8, "antibody_count": 1422111, "no-antibody_count": 232578, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1", "sample_type": "antibody", "neut_standard_frac": 0.1188, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "antibody": "C68.59", "antibody_concentration": 323.2, "antibody_count": 1222361, "no-antibody_count": 232578, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1", "sample_type": "antibody", "neut_standard_frac": 0.09881, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "antibody": "C68.59", "antibody_concentration": 20.2, "antibody_count": 2206727, "no-antibody_count": 246612, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1", "sample_type": "antibody", "neut_standard_frac": 0.1847, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "antibody": "C68.59", "antibody_concentration": 80.8, "antibody_count": 2777547, "no-antibody_count": 246612, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1", "sample_type": "antibody", "neut_standard_frac": 0.233, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "antibody": "C68.59", "antibody_concentration": 323.2, "antibody_count": 3146888, "no-antibody_count": 246612, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1", "sample_type": "antibody", "neut_standard_frac": 0.2334, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "antibody": "C68.59", "antibody_concentration": 80.8, "antibody_count": 1422111, "no-antibody_count": 232578, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1", "sample_type": "no-antibody", "neut_standard_frac": 0.003534, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "antibody": "C68.59", "antibody_concentration": 323.2, "antibody_count": 1222361, "no-antibody_count": 232578, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1", "sample_type": "no-antibody", "neut_standard_frac": 0.003534, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "antibody": "C68.59", "antibody_concentration": 20.2, "antibody_count": 2206727, "no-antibody_count": 246612, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1", "sample_type": "no-antibody", "neut_standard_frac": 0.003388, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "antibody": "C68.59", "antibody_concentration": 80.8, "antibody_count": 2777547, "no-antibody_count": 246612, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1", "sample_type": "no-antibody", "neut_standard_frac": 0.003388, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "antibody": "C68.59", "antibody_concentration": 323.2, "antibody_count": 3146888, "no-antibody_count": 246612, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1", "sample_type": "no-antibody", "neut_standard_frac": 0.003388, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1"}]}}, {"mode": "vega-lite"});
</script></div>
</div>
</section>
<section id="Overall-fraction-neutralization-by-number-of-mutations">
<h2>Overall fraction neutralization by number of mutations<a class="headerlink" href="#Overall-fraction-neutralization-by-number-of-mutations" title="Permalink to this headline">Â¶</a></h2>
<p>Plot neutralization (1 - probability of escape) averaged over all variants with a given number of mutations) for just the primary target. First, get the neutralization data ready to plot by just getting data for primary target, melting, and doing a few other transformations:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols_to_melt</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;prob_escape&quot;</span><span class="p">,</span> <span class="s2">&quot;prob_escape_uncensored&quot;</span><span class="p">]</span>
<span class="k">assert</span> <span class="s2">&quot;target&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">neutralization</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;only implemented for primary target&quot;</span>
<span class="n">neut_to_plot</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">neutralization</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
        <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">neutralization</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cols_to_melt</span><span class="p">],</span>
        <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;censored&quot;</span><span class="p">,</span>
        <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;fraction not neutralized&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">library_sample</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;antibody_sample&quot;</span><span class="p">],</span>
        <span class="n">censored</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;censored&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;prob_escape&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="p">{</span><span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;no&quot;</span><span class="p">}</span>
        <span class="p">),</span>
        <span class="n">n_aa_substitutions</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">x</span><span class="p">[</span><span class="s2">&quot;n_aa_substitutions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&gt;</span><span class="si">{</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;n_aa_substitutions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
            <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">neutralization</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">antibody_selections</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s2">&quot;many_to_one&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now make the plot. You can mouseover points for details, use the dropdown to subset samples, click on the legend to show only specific number of amino-acid substitutions or only censored (to [0, 1]) values or raw values. You should get worried if the censored and uncensored values look dramatically different:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">censored_selection</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;censored&quot;</span><span class="p">],</span>
    <span class="n">bind</span><span class="o">=</span><span class="s2">&quot;legend&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">n_aa_substitutions_selection</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;n_aa_substitutions&quot;</span><span class="p">],</span>
    <span class="n">bind</span><span class="o">=</span><span class="s2">&quot;legend&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">neutralization_chart</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">neut_to_plot</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;fraction not neutralized&quot;</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;library_sample&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span>
            <span class="s2">&quot;n_aa_substitutions:N&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;amino-acid mutations&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">neut_to_plot</span><span class="p">[</span><span class="s2">&quot;n_aa_substitutions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span>
        <span class="p">),</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Shape</span><span class="p">(</span>
            <span class="s2">&quot;censored:N&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;censored between 0 &amp; 1&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
                <span class="n">domain</span><span class="o">=</span><span class="n">neut_to_plot</span><span class="p">[</span><span class="s2">&quot;censored&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
                <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;triangle-up&quot;</span><span class="p">,</span> <span class="s2">&quot;triangle-down&quot;</span><span class="p">],</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.3g&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_count&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;fraction&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;antibody_concentration&quot;</span>
            <span class="k">else</span> <span class="n">c</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">neut_to_plot</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="s2">&quot;library_sample&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>
    <span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="n">censored_selection</span><span class="p">,</span> <span class="n">n_aa_substitutions_selection</span><span class="p">,</span> <span class="o">*</span><span class="n">selections</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">censored_selection</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">n_aa_substitutions_selection</span><span class="p">)</span>
    <span class="o">.</span><span class="n">configure_axis</span><span class="p">(</span><span class="n">labelLimit</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">selection</span> <span class="ow">in</span> <span class="n">selections</span><span class="p">:</span>
    <span class="n">neutralization_chart</span> <span class="o">=</span> <span class="n">neutralization_chart</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

<span class="n">neutralization_chart</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/fh/fast/bloom_j/computational_notebooks/bdadonai/2022/vep_dms/SARS-CoV-2_Omicron_BA.1_spike_DMS_268C.59A/.snakemake/conda/bc6cf8719714f906f2c5affd1f05c658/lib/python3.9/site-packages/altair/utils/core.py:317: FutureWarning: iteritems is deprecated and will be removed in a future version. Use .items instead.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div id="altair-viz-4a5783019b91429080f3292d7acbc865"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-4a5783019b91429080f3292d7acbc865") {
      outputDiv = document.getElementById("altair-viz-4a5783019b91429080f3292d7acbc865");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}, "axis": {"labelLimit": 500}}, "data": {"name": "data-f78a9ca707e2ccb7a680388ffb08c0ab"}, "mark": {"type": "point", "filled": true, "opacity": 0.7, "size": 50}, "encoding": {"color": {"field": "n_aa_substitutions", "scale": {"domain": ["0", "1", "2", "3", ">3"]}, "title": "amino-acid mutations", "type": "nominal"}, "shape": {"field": "censored", "scale": {"domain": ["no", "yes"], "range": ["triangle-up", "triangle-down"]}, "title": "censored between 0 & 1", "type": "nominal"}, "tooltip": [{"field": "library", "type": "nominal"}, {"field": "antibody_sample", "type": "nominal"}, {"field": "no-antibody_sample", "type": "nominal"}, {"field": "n_aa_substitutions", "type": "nominal"}, {"field": "antibody neut standard count", "type": "quantitative"}, {"field": "no-antibody neut standard count", "type": "quantitative"}, {"field": "antibody count", "type": "quantitative"}, {"field": "no-antibody count", "type": "quantitative"}, {"field": "censored", "type": "nominal"}, {"field": "fraction not neutralized", "format": ".3g", "type": "quantitative"}, {"field": "antibody", "type": "nominal"}, {"field": "antibody_concentration", "format": ".3g", "type": "quantitative"}, {"field": "virus_batch", "type": "nominal"}, {"field": "date", "type": "nominal"}, {"field": "replicate", "type": "quantitative"}, {"field": "selection_group", "type": "nominal"}], "x": {"field": "fraction not neutralized", "type": "quantitative"}, "y": {"field": "library_sample", "title": null, "type": "nominal"}}, "height": {"step": 14}, "params": [{"name": "parameter005", "select": {"type": "point", "fields": ["censored"]}, "bind": "legend"}, {"name": "parameter006", "select": {"type": "point", "fields": ["n_aa_substitutions"]}, "bind": "legend"}, {"name": "parameter001", "select": {"type": "point", "fields": ["library"]}, "bind": {"input": "select", "options": [null, "Lib-2", "Lib-3"], "labels": ["all", "Lib-2", "Lib-3"], "name": "library"}}, {"name": "parameter002", "select": {"type": "point", "fields": ["date"]}, "bind": {"input": "select", "options": [null, "2022-06-22"], "labels": ["all", "2022-06-22"], "name": "date"}}, {"name": "parameter003", "select": {"type": "point", "fields": ["antibody"]}, "bind": {"input": "select", "options": [null, "C68.59"], "labels": ["all", "C68.59"], "name": "antibody"}}, {"name": "parameter004", "select": {"type": "point", "fields": ["virus_batch"]}, "bind": {"input": "select", "options": [null, "thaw-1"], "labels": ["all", "thaw-1"], "name": "virus_batch"}}], "transform": [{"filter": {"param": "parameter005"}}, {"filter": {"param": "parameter006"}}, {"filter": {"param": "parameter001"}}, {"filter": {"param": "parameter002"}}, {"filter": {"param": "parameter003"}}, {"filter": {"param": "parameter004"}}], "width": 300, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-f78a9ca707e2ccb7a680388ffb08c0ab": [{"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "0", "antibody neut standard count": 1222361, "no-antibody neut standard count": 232578, "antibody count": 1707099, "no-antibody count": 16707349, "censored": "no", "fraction not neutralized": 0.01944, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "1", "antibody neut standard count": 1222361, "no-antibody neut standard count": 232578, "antibody count": 3328782, "no-antibody count": 21757588, "censored": "no", "fraction not neutralized": 0.02911, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "2", "antibody neut standard count": 1222361, "no-antibody neut standard count": 232578, "antibody count": 2944295, "no-antibody count": 15391637, "censored": "no", "fraction not neutralized": 0.0364, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "3", "antibody neut standard count": 1222361, "no-antibody neut standard count": 232578, "antibody count": 1810983, "no-antibody count": 7523364, "censored": "no", "fraction not neutralized": 0.0458, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": ">3", "antibody neut standard count": 1222361, "no-antibody neut standard count": 232578, "antibody count": 1357845, "no-antibody count": 4196043, "censored": "no", "fraction not neutralized": 0.06157, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "0", "antibody neut standard count": 1422111, "no-antibody neut standard count": 232578, "antibody count": 1718927, "no-antibody count": 16707349, "censored": "no", "fraction not neutralized": 0.01683, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "1", "antibody neut standard count": 1422111, "no-antibody neut standard count": 232578, "antibody count": 3152078, "no-antibody count": 21757588, "censored": "no", "fraction not neutralized": 0.02369, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "2", "antibody neut standard count": 1422111, "no-antibody neut standard count": 232578, "antibody count": 2774505, "no-antibody count": 15391637, "censored": "no", "fraction not neutralized": 0.02948, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "3", "antibody neut standard count": 1422111, "no-antibody neut standard count": 232578, "antibody count": 1654348, "no-antibody count": 7523364, "censored": "no", "fraction not neutralized": 0.03596, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": ">3", "antibody neut standard count": 1422111, "no-antibody neut standard count": 232578, "antibody count": 1251720, "no-antibody count": 4196043, "censored": "no", "fraction not neutralized": 0.04879, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "0", "antibody neut standard count": 2206727, "no-antibody neut standard count": 246612, "antibody count": 1617243, "no-antibody count": 19953602, "censored": "no", "fraction not neutralized": 0.009058, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "1", "antibody neut standard count": 2206727, "no-antibody neut standard count": 246612, "antibody count": 3025997, "no-antibody count": 24754495, "censored": "no", "fraction not neutralized": 0.01366, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "2", "antibody neut standard count": 2206727, "no-antibody neut standard count": 246612, "antibody count": 2536580, "no-antibody count": 16173452, "censored": "no", "fraction not neutralized": 0.01753, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "3", "antibody neut standard count": 2206727, "no-antibody neut standard count": 246612, "antibody count": 1532475, "no-antibody count": 7748776, "censored": "no", "fraction not neutralized": 0.0221, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": ">3", "antibody neut standard count": 2206727, "no-antibody neut standard count": 246612, "antibody count": 1030627, "no-antibody count": 3915462, "censored": "no", "fraction not neutralized": 0.02942, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "0", "antibody neut standard count": 3146888, "no-antibody neut standard count": 246612, "antibody count": 1707645, "no-antibody count": 19953602, "censored": "no", "fraction not neutralized": 0.006707, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "1", "antibody neut standard count": 3146888, "no-antibody neut standard count": 246612, "antibody count": 3082657, "no-antibody count": 24754495, "censored": "no", "fraction not neutralized": 0.009759, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "2", "antibody neut standard count": 3146888, "no-antibody neut standard count": 246612, "antibody count": 2765721, "no-antibody count": 16173452, "censored": "no", "fraction not neutralized": 0.0134, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "3", "antibody neut standard count": 3146888, "no-antibody neut standard count": 246612, "antibody count": 1617238, "no-antibody count": 7748776, "censored": "no", "fraction not neutralized": 0.01636, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": ">3", "antibody neut standard count": 3146888, "no-antibody neut standard count": 246612, "antibody count": 1162237, "no-antibody count": 3915462, "censored": "no", "fraction not neutralized": 0.02326, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "0", "antibody neut standard count": 2777547, "no-antibody neut standard count": 246612, "antibody count": 1499324, "no-antibody count": 19953602, "censored": "no", "fraction not neutralized": 0.006672, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "1", "antibody neut standard count": 2777547, "no-antibody neut standard count": 246612, "antibody count": 2804517, "no-antibody count": 24754495, "censored": "no", "fraction not neutralized": 0.01006, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "2", "antibody neut standard count": 2777547, "no-antibody neut standard count": 246612, "antibody count": 2377524, "no-antibody count": 16173452, "censored": "no", "fraction not neutralized": 0.01305, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "3", "antibody neut standard count": 2777547, "no-antibody neut standard count": 246612, "antibody count": 1453665, "no-antibody count": 7748776, "censored": "no", "fraction not neutralized": 0.01666, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": ">3", "antibody neut standard count": 2777547, "no-antibody neut standard count": 246612, "antibody count": 1008598, "no-antibody count": 3915462, "censored": "no", "fraction not neutralized": 0.02287, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "0", "antibody neut standard count": 1222361, "no-antibody neut standard count": 232578, "antibody count": 1707099, "no-antibody count": 16707349, "censored": "yes", "fraction not neutralized": 0.01944, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "1", "antibody neut standard count": 1222361, "no-antibody neut standard count": 232578, "antibody count": 3328782, "no-antibody count": 21757588, "censored": "yes", "fraction not neutralized": 0.02911, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "2", "antibody neut standard count": 1222361, "no-antibody neut standard count": 232578, "antibody count": 2944295, "no-antibody count": 15391637, "censored": "yes", "fraction not neutralized": 0.0364, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "3", "antibody neut standard count": 1222361, "no-antibody neut standard count": 232578, "antibody count": 1810983, "no-antibody count": 7523364, "censored": "yes", "fraction not neutralized": 0.0458, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": ">3", "antibody neut standard count": 1222361, "no-antibody neut standard count": 232578, "antibody count": 1357845, "no-antibody count": 4196043, "censored": "yes", "fraction not neutralized": 0.06157, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "0", "antibody neut standard count": 1422111, "no-antibody neut standard count": 232578, "antibody count": 1718927, "no-antibody count": 16707349, "censored": "yes", "fraction not neutralized": 0.01683, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "1", "antibody neut standard count": 1422111, "no-antibody neut standard count": 232578, "antibody count": 3152078, "no-antibody count": 21757588, "censored": "yes", "fraction not neutralized": 0.02369, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "2", "antibody neut standard count": 1422111, "no-antibody neut standard count": 232578, "antibody count": 2774505, "no-antibody count": 15391637, "censored": "yes", "fraction not neutralized": 0.02948, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "3", "antibody neut standard count": 1422111, "no-antibody neut standard count": 232578, "antibody count": 1654348, "no-antibody count": 7523364, "censored": "yes", "fraction not neutralized": 0.03596, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": ">3", "antibody neut standard count": 1422111, "no-antibody neut standard count": 232578, "antibody count": 1251720, "no-antibody count": 4196043, "censored": "yes", "fraction not neutralized": 0.04879, "library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-2_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "0", "antibody neut standard count": 2206727, "no-antibody neut standard count": 246612, "antibody count": 1617243, "no-antibody count": 19953602, "censored": "yes", "fraction not neutralized": 0.009058, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "1", "antibody neut standard count": 2206727, "no-antibody neut standard count": 246612, "antibody count": 3025997, "no-antibody count": 24754495, "censored": "yes", "fraction not neutralized": 0.01366, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "2", "antibody neut standard count": 2206727, "no-antibody neut standard count": 246612, "antibody count": 2536580, "no-antibody count": 16173452, "censored": "yes", "fraction not neutralized": 0.01753, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "3", "antibody neut standard count": 2206727, "no-antibody neut standard count": 246612, "antibody count": 1532475, "no-antibody count": 7748776, "censored": "yes", "fraction not neutralized": 0.0221, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": ">3", "antibody neut standard count": 2206727, "no-antibody neut standard count": 246612, "antibody count": 1030627, "no-antibody count": 3915462, "censored": "yes", "fraction not neutralized": 0.02942, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "0", "antibody neut standard count": 3146888, "no-antibody neut standard count": 246612, "antibody count": 1707645, "no-antibody count": 19953602, "censored": "yes", "fraction not neutralized": 0.006707, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "1", "antibody neut standard count": 3146888, "no-antibody neut standard count": 246612, "antibody count": 3082657, "no-antibody count": 24754495, "censored": "yes", "fraction not neutralized": 0.009759, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "2", "antibody neut standard count": 3146888, "no-antibody neut standard count": 246612, "antibody count": 2765721, "no-antibody count": 16173452, "censored": "yes", "fraction not neutralized": 0.0134, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "3", "antibody neut standard count": 3146888, "no-antibody neut standard count": 246612, "antibody count": 1617238, "no-antibody count": 7748776, "censored": "yes", "fraction not neutralized": 0.01636, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": ">3", "antibody neut standard count": 3146888, "no-antibody neut standard count": 246612, "antibody count": 1162237, "no-antibody count": 3915462, "censored": "yes", "fraction not neutralized": 0.02326, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "0", "antibody neut standard count": 2777547, "no-antibody neut standard count": 246612, "antibody count": 1499324, "no-antibody count": 19953602, "censored": "yes", "fraction not neutralized": 0.006672, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "1", "antibody neut standard count": 2777547, "no-antibody neut standard count": 246612, "antibody count": 2804517, "no-antibody count": 24754495, "censored": "yes", "fraction not neutralized": 0.01006, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "2", "antibody neut standard count": 2777547, "no-antibody neut standard count": 246612, "antibody count": 2377524, "no-antibody count": 16173452, "censored": "yes", "fraction not neutralized": 0.01305, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": "3", "antibody neut standard count": 2777547, "no-antibody neut standard count": 246612, "antibody count": 1453665, "no-antibody count": 7748776, "censored": "yes", "fraction not neutralized": 0.01666, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "n_aa_substitutions": ">3", "antibody neut standard count": 2777547, "no-antibody neut standard count": 246612, "antibody count": 1008598, "no-antibody count": 3915462, "censored": "yes", "fraction not neutralized": 0.02287, "library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "replicate": 1, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_library_sample": "Lib-3_2022-06-22_thaw-1_no-antibody_control_1", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}]}}, {"mode": "vega-lite"});
</script></div>
</div>
</section>
<section id="Variants-with-sufficient-no-antibody-counts">
<h2>Variants with sufficient no-antibody counts<a class="headerlink" href="#Variants-with-sufficient-no-antibody-counts" title="Permalink to this headline">Â¶</a></h2>
<p>We only calculate the probability of escape for variants with some minimum threshold of no-antibody counts.</p>
<p>Draw a boxplot for the no-antibody samples with a black line at the median, boxes spanning the 25th to 75th percentiles, lines spanning the minimum to the maximum, and a red line indciating the threshold. You can mouseover bars for details and use the dropdown selections to just show certain subsets. Note that y-axis uses a symlog scale:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get data to plot</span>
<span class="n">no_antibody_count_boxplot_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">prob_escape</span><span class="p">[</span>
        <span class="p">[</span>
            <span class="s2">&quot;library&quot;</span><span class="p">,</span>
            <span class="s2">&quot;no-antibody_sample&quot;</span><span class="p">,</span>
            <span class="s2">&quot;no-antibody_count&quot;</span><span class="p">,</span>
            <span class="s2">&quot;barcode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;no_antibody_count_threshold&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span>
    <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">variant_above_threshold</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">x</span><span class="p">[</span><span class="s2">&quot;no-antibody_count&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;no_antibody_count_threshold&quot;</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
        <span class="n">count_above_threshold</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;no-antibody_count&quot;</span><span class="p">]</span>
        <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;variant_above_threshold&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="s2">&quot;no-antibody_sample&quot;</span><span class="p">,</span> <span class="s2">&quot;no_antibody_count_threshold&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
        <span class="n">median</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;no-antibody_count&quot;</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">),</span>
        <span class="n">percentile_25</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;no-antibody_count&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)),</span>
        <span class="n">percentile_75</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;no-antibody_count&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)),</span>
        <span class="nb">min</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;no-antibody_count&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">),</span>
        <span class="nb">max</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;no-antibody_count&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">),</span>
        <span class="n">nvariants</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;barcode&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">),</span>
        <span class="n">total_counts</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;no-antibody_count&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">),</span>
        <span class="n">variants_above_threshold</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;variant_above_threshold&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">),</span>
        <span class="n">counts_above_threshold</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;count_above_threshold&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">library_sample</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;no-antibody_sample&quot;</span><span class="p">],</span>
        <span class="n">frac_counts_above_threshold</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;counts_above_threshold&quot;</span><span class="p">]</span>
        <span class="o">/</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;total_counts&quot;</span><span class="p">],</span>
        <span class="n">frac_variants_above_threshold</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;variants_above_threshold&quot;</span><span class="p">]</span>
        <span class="o">/</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;nvariants&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">drop</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;counts_above_threshold&quot;</span><span class="p">,</span>
            <span class="s2">&quot;variants_above_threshold&quot;</span><span class="p">,</span>
            <span class="s2">&quot;total_counts&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nvariants&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">antibody_selections</span><span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;no-antibody_sample&quot;</span><span class="p">,</span> <span class="s2">&quot;virus_batch&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;library&quot;</span><span class="p">]</span>
        <span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span>
        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="n">validate</span><span class="o">=</span><span class="s2">&quot;one_to_one&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">no_antibody_count_boxplot_df</span><span class="p">)</span>
    <span class="o">==</span> <span class="n">no_antibody_count_boxplot_df</span><span class="p">[</span><span class="s2">&quot;library_sample&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># make plot</span>
<span class="n">no_antibody_count_base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">no_antibody_count_boxplot_df</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;library_sample&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2g&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">no_antibody_count_boxplot_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">float</span>
        <span class="k">else</span> <span class="n">c</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">no_antibody_count_boxplot_df</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;library_sample&quot;</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">no_antibody_count_quartile_bars</span> <span class="o">=</span> <span class="n">no_antibody_count_base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
        <span class="s2">&quot;percentile_25&quot;</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;symlog&quot;</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;counts for variant&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X2</span><span class="p">(</span><span class="s2">&quot;percentile_75&quot;</span><span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>

<span class="n">no_antibody_count_range_lines</span> <span class="o">=</span> <span class="n">no_antibody_count_base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X2</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">no_antibody_count_median_lines</span> <span class="o">=</span> <span class="n">no_antibody_count_base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;median&quot;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">X2</span><span class="p">(</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">(</span><span class="n">xOffset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x2Offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

<span class="n">no_antibody_count_threshold</span> <span class="o">=</span> <span class="n">no_antibody_count_base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;no_antibody_count_threshold&quot;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">X2</span><span class="p">(</span><span class="s2">&quot;no_antibody_count_threshold&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">(</span><span class="n">xOffset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x2Offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>

<span class="n">no_antibody_count_chart</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span>
        <span class="n">no_antibody_count_quartile_bars</span>
        <span class="o">+</span> <span class="n">no_antibody_count_range_lines</span>
        <span class="o">+</span> <span class="n">no_antibody_count_median_lines</span>
        <span class="o">+</span> <span class="n">no_antibody_count_threshold</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">configure_axis</span><span class="p">(</span><span class="n">labelLimit</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">350</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">selections</span><span class="p">,</span> <span class="n">selection_names</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;antibody&quot;</span><span class="p">:</span>
        <span class="n">no_antibody_count_chart</span> <span class="o">=</span> <span class="n">no_antibody_count_chart</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span>
            <span class="n">s</span>
        <span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="n">no_antibody_count_chart</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/fh/fast/bloom_j/computational_notebooks/bdadonai/2022/vep_dms/SARS-CoV-2_Omicron_BA.1_spike_DMS_268C.59A/.snakemake/conda/bc6cf8719714f906f2c5affd1f05c658/lib/python3.9/site-packages/altair/utils/core.py:317: FutureWarning: iteritems is deprecated and will be removed in a future version. Use .items instead.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div id="altair-viz-5b742b7e0dfa4a18bc29290721b3bd2f"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-5b742b7e0dfa4a18bc29290721b3bd2f") {
      outputDiv = document.getElementById("altair-viz-5b742b7e0dfa4a18bc29290721b3bd2f");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}, "axis": {"labelLimit": 500}}, "layer": [{"mark": {"type": "bar", "color": "blue"}, "encoding": {"tooltip": [{"field": "library", "type": "nominal"}, {"field": "no-antibody_sample", "type": "nominal"}, {"field": "no_antibody_count_threshold", "type": "quantitative"}, {"field": "median", "format": ".2g", "type": "quantitative"}, {"field": "percentile_25", "format": ".2g", "type": "quantitative"}, {"field": "percentile_75", "format": ".2g", "type": "quantitative"}, {"field": "min", "type": "quantitative"}, {"field": "max", "type": "quantitative"}, {"field": "frac_counts_above_threshold", "format": ".2g", "type": "quantitative"}, {"field": "frac_variants_above_threshold", "format": ".2g", "type": "quantitative"}, {"field": "virus_batch", "type": "nominal"}, {"field": "date", "type": "nominal"}], "x": {"field": "percentile_25", "scale": {"constant": 20, "type": "symlog"}, "title": "counts for variant", "type": "quantitative"}, "x2": {"field": "percentile_75"}, "y": {"field": "library_sample", "title": null, "type": "nominal"}}, "params": [{"name": "parameter001", "select": {"type": "point", "fields": ["library"]}, "bind": {"input": "select", "options": [null, "Lib-2", "Lib-3"], "labels": ["all", "Lib-2", "Lib-3"], "name": "library"}}, {"name": "parameter002", "select": {"type": "point", "fields": ["date"]}, "bind": {"input": "select", "options": [null, "2022-06-22"], "labels": ["all", "2022-06-22"], "name": "date"}}, {"name": "parameter004", "select": {"type": "point", "fields": ["virus_batch"]}, "bind": {"input": "select", "options": [null, "thaw-1"], "labels": ["all", "thaw-1"], "name": "virus_batch"}}]}, {"mark": {"type": "rule", "color": "blue", "opacity": 0.5}, "encoding": {"tooltip": [{"field": "library", "type": "nominal"}, {"field": "no-antibody_sample", "type": "nominal"}, {"field": "no_antibody_count_threshold", "type": "quantitative"}, {"field": "median", "format": ".2g", "type": "quantitative"}, {"field": "percentile_25", "format": ".2g", "type": "quantitative"}, {"field": "percentile_75", "format": ".2g", "type": "quantitative"}, {"field": "min", "type": "quantitative"}, {"field": "max", "type": "quantitative"}, {"field": "frac_counts_above_threshold", "format": ".2g", "type": "quantitative"}, {"field": "frac_variants_above_threshold", "format": ".2g", "type": "quantitative"}, {"field": "virus_batch", "type": "nominal"}, {"field": "date", "type": "nominal"}], "x": {"field": "min", "type": "quantitative"}, "x2": {"field": "max"}, "y": {"field": "library_sample", "title": null, "type": "nominal"}}}, {"mark": {"type": "bar", "color": "black", "x2Offset": -1, "xOffset": 1}, "encoding": {"tooltip": [{"field": "library", "type": "nominal"}, {"field": "no-antibody_sample", "type": "nominal"}, {"field": "no_antibody_count_threshold", "type": "quantitative"}, {"field": "median", "format": ".2g", "type": "quantitative"}, {"field": "percentile_25", "format": ".2g", "type": "quantitative"}, {"field": "percentile_75", "format": ".2g", "type": "quantitative"}, {"field": "min", "type": "quantitative"}, {"field": "max", "type": "quantitative"}, {"field": "frac_counts_above_threshold", "format": ".2g", "type": "quantitative"}, {"field": "frac_variants_above_threshold", "format": ".2g", "type": "quantitative"}, {"field": "virus_batch", "type": "nominal"}, {"field": "date", "type": "nominal"}], "x": {"field": "median", "type": "quantitative"}, "x2": {"field": "median"}, "y": {"field": "library_sample", "title": null, "type": "nominal"}}}, {"mark": {"type": "bar", "color": "red", "x2Offset": -1, "xOffset": 1}, "encoding": {"tooltip": [{"field": "library", "type": "nominal"}, {"field": "no-antibody_sample", "type": "nominal"}, {"field": "no_antibody_count_threshold", "type": "quantitative"}, {"field": "median", "format": ".2g", "type": "quantitative"}, {"field": "percentile_25", "format": ".2g", "type": "quantitative"}, {"field": "percentile_75", "format": ".2g", "type": "quantitative"}, {"field": "min", "type": "quantitative"}, {"field": "max", "type": "quantitative"}, {"field": "frac_counts_above_threshold", "format": ".2g", "type": "quantitative"}, {"field": "frac_variants_above_threshold", "format": ".2g", "type": "quantitative"}, {"field": "virus_batch", "type": "nominal"}, {"field": "date", "type": "nominal"}], "x": {"field": "no_antibody_count_threshold", "type": "quantitative"}, "x2": {"field": "no_antibody_count_threshold"}, "y": {"field": "library_sample", "title": null, "type": "nominal"}}}], "data": {"name": "data-b6ee2aaf1f26ab63d253cab8d9235554"}, "height": {"step": 14}, "transform": [{"filter": {"param": "parameter001"}}, {"filter": {"param": "parameter002"}}, {"filter": {"param": "parameter004"}}], "width": 350, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-b6ee2aaf1f26ab63d253cab8d9235554": [{"library": "Lib-2", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "no_antibody_count_threshold": 66, "median": 269.0, "percentile_25": 58.0, "percentile_75": 640.0, "min": 0, "max": 14462, "library_sample": "Lib-2 2022-06-22_thaw-1_no-antibody_control_1", "frac_counts_above_threshold": 0.9906844855283217, "frac_variants_above_threshold": 0.7380601949617116, "virus_batch": "thaw-1", "date": "2022-06-22"}, {"library": "Lib-3", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "no_antibody_count_threshold": 73, "median": 296.0, "percentile_25": 52.5, "percentile_75": 772.0, "min": 0, "max": 16612, "library_sample": "Lib-3 2022-06-22_thaw-1_no-antibody_control_1", "frac_counts_above_threshold": 0.9912000127588387, "frac_variants_above_threshold": 0.7212192412508891, "virus_batch": "thaw-1", "date": "2022-06-22"}]}}, {"mode": "vega-lite"});
</script></div>
</div>
<p>Plot the fraction of all variants, and fraction of all counts, that are above the thresholds for the no-antibody conditions:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frac_counts_df</span> <span class="o">=</span> <span class="n">no_antibody_count_boxplot_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;median&quot;</span><span class="p">,</span>
        <span class="s2">&quot;no_antibody_count_threshold&quot;</span><span class="p">,</span>
        <span class="s2">&quot;min&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max&quot;</span><span class="p">,</span>
        <span class="s2">&quot;percentile_25&quot;</span><span class="p">,</span>
        <span class="s2">&quot;percentile_75&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;frac_counts_above_threshold&quot;</span><span class="p">:</span> <span class="s2">&quot;counts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frac_variants_above_threshold&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">fraction_type_selection</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fraction_type&quot;</span><span class="p">],</span>
    <span class="n">bind</span><span class="o">=</span><span class="s2">&quot;legend&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">frac_counts_chart</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">frac_counts_df</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_fold</span><span class="p">(</span><span class="n">fold</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;counts&quot;</span><span class="p">,</span> <span class="s2">&quot;variants&quot;</span><span class="p">],</span> <span class="n">as_</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fraction_type&quot;</span><span class="p">,</span> <span class="s2">&quot;fraction&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;library_sample&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.2g&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">frac_counts_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">float</span> <span class="k">else</span> <span class="n">c</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">frac_counts_df</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;library_sample&quot;</span>
        <span class="p">],</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
            <span class="s2">&quot;fraction:Q&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;fraction above threshold&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span>
            <span class="s2">&quot;fraction_type:N&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;counts&quot;</span><span class="p">,</span> <span class="s2">&quot;variants&quot;</span><span class="p">]),</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>
    <span class="o">.</span><span class="n">configure_axis</span><span class="p">(</span><span class="n">labelLimit</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="n">fraction_type_selection</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">fraction_type_selection</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">selections</span><span class="p">,</span> <span class="n">selection_names</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;antibody&quot;</span><span class="p">:</span>
        <span class="n">frac_counts_chart</span> <span class="o">=</span> <span class="n">frac_counts_chart</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="n">frac_counts_chart</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/fh/fast/bloom_j/computational_notebooks/bdadonai/2022/vep_dms/SARS-CoV-2_Omicron_BA.1_spike_DMS_268C.59A/.snakemake/conda/bc6cf8719714f906f2c5affd1f05c658/lib/python3.9/site-packages/altair/utils/core.py:317: FutureWarning: iteritems is deprecated and will be removed in a future version. Use .items instead.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div id="altair-viz-a3651600f4834af6a136adf36a38692e"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-a3651600f4834af6a136adf36a38692e") {
      outputDiv = document.getElementById("altair-viz-a3651600f4834af6a136adf36a38692e");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}, "axis": {"labelLimit": 500}}, "data": {"name": "data-305464f60ce4822052811c9be6f8c270"}, "mark": {"type": "point", "filled": true, "size": 50}, "encoding": {"color": {"field": "fraction_type", "scale": {"domain": ["counts", "variants"]}, "title": null, "type": "nominal"}, "tooltip": [{"field": "library", "type": "nominal"}, {"field": "no-antibody_sample", "type": "nominal"}, {"field": "counts", "format": ".2g", "type": "quantitative"}, {"field": "variants", "format": ".2g", "type": "quantitative"}, {"field": "virus_batch", "type": "nominal"}, {"field": "date", "type": "nominal"}], "x": {"field": "fraction", "scale": {"domain": [0, 1]}, "title": "fraction above threshold", "type": "quantitative"}, "y": {"field": "library_sample", "title": null, "type": "nominal"}}, "height": {"step": 14}, "params": [{"name": "parameter007", "select": {"type": "point", "fields": ["fraction_type"]}, "bind": "legend"}, {"name": "parameter001", "select": {"type": "point", "fields": ["library"]}, "bind": {"input": "select", "options": [null, "Lib-2", "Lib-3"], "labels": ["all", "Lib-2", "Lib-3"], "name": "library"}}, {"name": "parameter002", "select": {"type": "point", "fields": ["date"]}, "bind": {"input": "select", "options": [null, "2022-06-22"], "labels": ["all", "2022-06-22"], "name": "date"}}, {"name": "parameter004", "select": {"type": "point", "fields": ["virus_batch"]}, "bind": {"input": "select", "options": [null, "thaw-1"], "labels": ["all", "thaw-1"], "name": "virus_batch"}}], "transform": [{"fold": ["counts", "variants"], "as": ["fraction_type", "fraction"]}, {"filter": {"param": "parameter007"}}, {"filter": {"param": "parameter001"}}, {"filter": {"param": "parameter002"}}, {"filter": {"param": "parameter004"}}], "width": 200, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-305464f60ce4822052811c9be6f8c270": [{"library": "Lib-2", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "library_sample": "Lib-2 2022-06-22_thaw-1_no-antibody_control_1", "counts": 0.9906844855283217, "variants": 0.7380601949617116, "virus_batch": "thaw-1", "date": "2022-06-22"}, {"library": "Lib-3", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "library_sample": "Lib-3 2022-06-22_thaw-1_no-antibody_control_1", "counts": 0.9912000127588387, "variants": 0.7212192412508891, "virus_batch": "thaw-1", "date": "2022-06-22"}]}}, {"mode": "vega-lite"});
</script></div>
</div>
<p>Now just get probability of escape measurements for variants that exceed no-antibody count threshold:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_escape_filtered</span> <span class="o">=</span> <span class="n">prob_escape</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="s2">&quot;`no-antibody_count` &gt;= no_antibody_count_threshold&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Distribution-of-probability-escape-across-variants">
<h2>Distribution of probability escape across variants<a class="headerlink" href="#Distribution-of-probability-escape-across-variants" title="Permalink to this headline">Â¶</a></h2>
<p>Plot distribution of prob escape values across non-filtered variants. The boxes span 25th to 75th percentile, the black vertical line is at the median, and the thin lines extend from the min to max. You can show either the censored (to between 0 and 1) or uncensored probabilities of escape. Note the plot uses a symlog scale:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get data to plot</span>
<span class="n">prob_escape_boxplot_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">prob_escape_filtered</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
        <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="s2">&quot;antibody_sample&quot;</span><span class="p">,</span> <span class="s2">&quot;no-antibody_sample&quot;</span><span class="p">],</span>
        <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;prob_escape&quot;</span><span class="p">,</span> <span class="s2">&quot;prob_escape_uncensored&quot;</span><span class="p">],</span>
        <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;censored&quot;</span><span class="p">,</span>
        <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;probability escape&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="s2">&quot;antibody_sample&quot;</span><span class="p">,</span> <span class="s2">&quot;no-antibody_sample&quot;</span><span class="p">,</span> <span class="s2">&quot;censored&quot;</span><span class="p">],</span>
        <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
        <span class="n">median</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;probability escape&quot;</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">),</span>
        <span class="n">percentile_25</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;probability escape&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)),</span>
        <span class="n">percentile_75</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;probability escape&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)),</span>
        <span class="nb">min</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;probability escape&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">),</span>
        <span class="nb">max</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="s2">&quot;probability escape&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">censored</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;censored&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;prob_escape&quot;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">antibody_selections</span><span class="p">[</span>
            <span class="p">[</span>
                <span class="s2">&quot;antibody_sample&quot;</span><span class="p">,</span>
                <span class="s2">&quot;antibody_library_sample&quot;</span><span class="p">,</span>
                <span class="s2">&quot;virus_batch&quot;</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">,</span>
                <span class="s2">&quot;library&quot;</span><span class="p">,</span>
                <span class="s2">&quot;antibody&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="s2">&quot;antibody_sample&quot;</span><span class="p">],</span>
        <span class="n">validate</span><span class="o">=</span><span class="s2">&quot;many_to_one&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">prob_escape_boxplot_df</span><span class="p">)</span>
    <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">prob_escape_boxplot_df</span><span class="p">[</span><span class="s2">&quot;antibody_library_sample&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># make plot</span>
<span class="n">prob_escape_base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">prob_escape_boxplot_df</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;antibody_library_sample&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">sample_order</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.3g&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prob_escape_boxplot_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span>
        <span class="k">else</span> <span class="n">c</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">prob_escape_boxplot_df</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;antibody_library_sample&quot;</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">prob_escape_quartile_bars</span> <span class="o">=</span> <span class="n">prob_escape_base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
        <span class="s2">&quot;percentile_25&quot;</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;symlog&quot;</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="mf">0.25</span><span class="p">),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;probability escape&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X2</span><span class="p">(</span><span class="s2">&quot;percentile_75&quot;</span><span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>

<span class="n">prob_escape_range_lines</span> <span class="o">=</span> <span class="n">prob_escape_base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X2</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">prob_escape_median_lines</span> <span class="o">=</span> <span class="n">prob_escape_base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;median&quot;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">X2</span><span class="p">(</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">(</span><span class="n">xOffset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x2Offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

<span class="n">prob_escape_chart</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">prob_escape_quartile_bars</span> <span class="o">+</span> <span class="n">prob_escape_range_lines</span> <span class="o">+</span> <span class="n">prob_escape_median_lines</span><span class="p">)</span>
    <span class="o">.</span><span class="n">configure_axis</span><span class="p">(</span><span class="n">labelLimit</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">350</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">censored_dropdown_selection</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;censored&quot;</span><span class="p">],</span>
    <span class="n">value</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;censored&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}],</span>
    <span class="n">bind</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">binding_select</span><span class="p">(</span>
        <span class="n">options</span><span class="o">=</span><span class="n">prob_escape_boxplot_df</span><span class="p">[</span><span class="s2">&quot;censored&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;censored&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">selections</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">censored_dropdown_selection</span><span class="p">]:</span>
    <span class="n">prob_escape_chart</span> <span class="o">=</span> <span class="n">prob_escape_chart</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="n">prob_escape_chart</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/fh/fast/bloom_j/computational_notebooks/bdadonai/2022/vep_dms/SARS-CoV-2_Omicron_BA.1_spike_DMS_268C.59A/.snakemake/conda/bc6cf8719714f906f2c5affd1f05c658/lib/python3.9/site-packages/altair/utils/core.py:317: FutureWarning: iteritems is deprecated and will be removed in a future version. Use .items instead.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div id="altair-viz-7fd4c4d5459047c6970d5cfdfb208583"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-7fd4c4d5459047c6970d5cfdfb208583") {
      outputDiv = document.getElementById("altair-viz-7fd4c4d5459047c6970d5cfdfb208583");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}, "axis": {"labelLimit": 500}}, "layer": [{"mark": {"type": "bar", "color": "blue"}, "encoding": {"tooltip": [{"field": "library", "type": "nominal"}, {"field": "antibody_sample", "type": "nominal"}, {"field": "no-antibody_sample", "type": "nominal"}, {"field": "censored", "type": "nominal"}, {"field": "median", "format": ".3g", "type": "quantitative"}, {"field": "percentile_25", "format": ".3g", "type": "quantitative"}, {"field": "percentile_75", "format": ".3g", "type": "quantitative"}, {"field": "min", "format": ".3g", "type": "quantitative"}, {"field": "max", "format": ".3g", "type": "quantitative"}, {"field": "virus_batch", "type": "nominal"}, {"field": "date", "type": "nominal"}, {"field": "antibody", "type": "nominal"}], "x": {"field": "percentile_25", "scale": {"constant": 0.25, "type": "symlog"}, "title": "probability escape", "type": "quantitative"}, "x2": {"field": "percentile_75"}, "y": {"field": "antibody_library_sample", "sort": ["Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1"], "title": null, "type": "nominal"}}, "params": [{"name": "parameter001", "select": {"type": "point", "fields": ["library"]}, "bind": {"input": "select", "options": [null, "Lib-2", "Lib-3"], "labels": ["all", "Lib-2", "Lib-3"], "name": "library"}}, {"name": "parameter002", "select": {"type": "point", "fields": ["date"]}, "bind": {"input": "select", "options": [null, "2022-06-22"], "labels": ["all", "2022-06-22"], "name": "date"}}, {"name": "parameter003", "select": {"type": "point", "fields": ["antibody"]}, "bind": {"input": "select", "options": [null, "C68.59"], "labels": ["all", "C68.59"], "name": "antibody"}}, {"name": "parameter004", "select": {"type": "point", "fields": ["virus_batch"]}, "bind": {"input": "select", "options": [null, "thaw-1"], "labels": ["all", "thaw-1"], "name": "virus_batch"}}, {"name": "parameter008", "select": {"type": "point", "fields": ["censored"]}, "bind": {"input": "select", "options": [true, false], "name": "censored"}, "value": [{"censored": true}]}]}, {"mark": {"type": "rule", "color": "blue", "opacity": 0.5}, "encoding": {"tooltip": [{"field": "library", "type": "nominal"}, {"field": "antibody_sample", "type": "nominal"}, {"field": "no-antibody_sample", "type": "nominal"}, {"field": "censored", "type": "nominal"}, {"field": "median", "format": ".3g", "type": "quantitative"}, {"field": "percentile_25", "format": ".3g", "type": "quantitative"}, {"field": "percentile_75", "format": ".3g", "type": "quantitative"}, {"field": "min", "format": ".3g", "type": "quantitative"}, {"field": "max", "format": ".3g", "type": "quantitative"}, {"field": "virus_batch", "type": "nominal"}, {"field": "date", "type": "nominal"}, {"field": "antibody", "type": "nominal"}], "x": {"field": "min", "type": "quantitative"}, "x2": {"field": "max"}, "y": {"field": "antibody_library_sample", "sort": ["Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1"], "title": null, "type": "nominal"}}}, {"mark": {"type": "bar", "color": "black", "x2Offset": -1, "xOffset": 1}, "encoding": {"tooltip": [{"field": "library", "type": "nominal"}, {"field": "antibody_sample", "type": "nominal"}, {"field": "no-antibody_sample", "type": "nominal"}, {"field": "censored", "type": "nominal"}, {"field": "median", "format": ".3g", "type": "quantitative"}, {"field": "percentile_25", "format": ".3g", "type": "quantitative"}, {"field": "percentile_75", "format": ".3g", "type": "quantitative"}, {"field": "min", "format": ".3g", "type": "quantitative"}, {"field": "max", "format": ".3g", "type": "quantitative"}, {"field": "virus_batch", "type": "nominal"}, {"field": "date", "type": "nominal"}, {"field": "antibody", "type": "nominal"}], "x": {"field": "median", "type": "quantitative"}, "x2": {"field": "median"}, "y": {"field": "antibody_library_sample", "sort": ["Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1"], "title": null, "type": "nominal"}}}], "data": {"name": "data-6ad53beeed17f5281ead11b5f97078ff"}, "height": {"step": 14}, "transform": [{"filter": {"param": "parameter001"}}, {"filter": {"param": "parameter002"}}, {"filter": {"param": "parameter003"}}, {"filter": {"param": "parameter004"}}, {"filter": {"param": "parameter008"}}], "width": 350, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-6ad53beeed17f5281ead11b5f97078ff": [{"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "censored": true, "median": 0.0001, "percentile_25": 0.0, "percentile_75": 0.0246, "min": 0.0, "max": 1.0, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "virus_batch": "thaw-1", "date": "2022-06-22", "antibody": "C68.59"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "censored": false, "median": 0.0001, "percentile_25": 0.0, "percentile_75": 0.0246, "min": 0.0, "max": 3.742, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "virus_batch": "thaw-1", "date": "2022-06-22", "antibody": "C68.59"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "censored": true, "median": 0.0, "percentile_25": 0.0, "percentile_75": 0.0011, "min": 0.0, "max": 1.0, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "virus_batch": "thaw-1", "date": "2022-06-22", "antibody": "C68.59"}, {"library": "Lib-2", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "censored": false, "median": 0.0, "percentile_25": 0.0, "percentile_75": 0.0011, "min": 0.0, "max": 3.6422, "antibody_library_sample": "Lib-2_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "virus_batch": "thaw-1", "date": "2022-06-22", "antibody": "C68.59"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "censored": true, "median": 0.0001, "percentile_25": 0.0, "percentile_75": 0.0097, "min": 0.0, "max": 1.0, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "virus_batch": "thaw-1", "date": "2022-06-22", "antibody": "C68.59"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "censored": false, "median": 0.0001, "percentile_25": 0.0, "percentile_75": 0.0097, "min": 0.0, "max": 2.0317, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_20.2_1", "virus_batch": "thaw-1", "date": "2022-06-22", "antibody": "C68.59"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "censored": true, "median": 0.0, "percentile_25": 0.0, "percentile_75": 0.0004, "min": 0.0, "max": 1.0, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "virus_batch": "thaw-1", "date": "2022-06-22", "antibody": "C68.59"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "censored": false, "median": 0.0, "percentile_25": 0.0, "percentile_75": 0.0004, "min": 0.0, "max": 2.031, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_323.2_1", "virus_batch": "thaw-1", "date": "2022-06-22", "antibody": "C68.59"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "censored": true, "median": 0.0, "percentile_25": 0.0, "percentile_75": 0.0004, "min": 0.0, "max": 1.0, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "virus_batch": "thaw-1", "date": "2022-06-22", "antibody": "C68.59"}, {"library": "Lib-3", "antibody_sample": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "no-antibody_sample": "2022-06-22_thaw-1_no-antibody_control_1", "censored": false, "median": 0.0, "percentile_25": 0.0, "percentile_75": 0.0004, "min": 0.0, "max": 1.7126, "antibody_library_sample": "Lib-3_2022-06-22_thaw-1_antibody_C68.59_80.8_1", "virus_batch": "thaw-1", "date": "2022-06-22", "antibody": "C68.59"}]}}, {"mode": "vega-lite"});
</script></div>
</div>
</section>
<section id="Correlations-in-variant-level-escape-probabilities">
<h2>Correlations in variant-level escape probabilities<a class="headerlink" href="#Correlations-in-variant-level-escape-probabilities" title="Permalink to this headline">Â¶</a></h2>
<p>Analyze correlations of escape probabilities of different variants in same library:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span>
    <span class="n">prob_escape_filtered</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="s2">&quot;antibody_sample&quot;</span><span class="p">,</span> <span class="s2">&quot;no-antibody_sample&quot;</span><span class="p">])</span>
<span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">prob_escape_filtered</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="s2">&quot;antibody_sample&quot;</span><span class="p">]))</span>

<span class="n">prob_escape_tidy</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">prob_escape_filtered</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;prob_escape&quot;</span><span class="p">:</span> <span class="s2">&quot;censored&quot;</span><span class="p">,</span> <span class="s2">&quot;prob_escape_uncensored&quot;</span><span class="p">:</span> <span class="s2">&quot;uncensored&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">melt</span><span class="p">(</span>
        <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;antibody_sample&quot;</span><span class="p">,</span> <span class="s2">&quot;barcode&quot;</span><span class="p">,</span> <span class="s2">&quot;library&quot;</span><span class="p">],</span>
        <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;censored&quot;</span><span class="p">,</span> <span class="s2">&quot;uncensored&quot;</span><span class="p">],</span>
        <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;prob_escape&quot;</span><span class="p">,</span>
        <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;censored&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">censored</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;censored&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;censored&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;uncensored&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">corrs</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dms_variants</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">tidy_to_corr</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">prob_escape_tidy</span><span class="p">,</span>
        <span class="n">sample_col</span><span class="o">=</span><span class="s2">&quot;antibody_sample&quot;</span><span class="p">,</span>
        <span class="n">label_col</span><span class="o">=</span><span class="s2">&quot;barcode&quot;</span><span class="p">,</span>
        <span class="n">value_col</span><span class="o">=</span><span class="s2">&quot;prob_escape&quot;</span><span class="p">,</span>
        <span class="n">group_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="s2">&quot;censored&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">r2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;correlation&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;correlation&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># add other properties</span>
<span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_2&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">suffixes</span><span class="p">:</span>
    <span class="n">corrs</span> <span class="o">=</span> <span class="n">corrs</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">antibody_selections</span><span class="p">,</span>
        <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;antibody_sample</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
        <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="s2">&quot;antibody_sample&quot;</span><span class="p">],</span>
        <span class="n">validate</span><span class="o">=</span><span class="s2">&quot;many_to_one&quot;</span><span class="p">,</span>
        <span class="n">suffixes</span><span class="o">=</span><span class="n">suffixes</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;antibody_library_sample&quot;</span><span class="p">,</span>
            <span class="s2">&quot;no-antibody_library_sample&quot;</span><span class="p">,</span>
            <span class="s2">&quot;no-antibody_sample&quot;</span><span class="p">,</span>
            <span class="s2">&quot;antibody_sample&quot;</span><span class="p">,</span>
            <span class="s2">&quot;replicate&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>

<span class="c1"># make columns identical for both samples drop suffix for selections</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">antibody_selections</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">_1&quot;</span> <span class="ow">in</span> <span class="n">corrs</span><span class="o">.</span><span class="n">columns</span>
        <span class="ow">and</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">_2&quot;</span> <span class="ow">in</span> <span class="n">corrs</span><span class="o">.</span><span class="n">columns</span>
        <span class="ow">and</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;antibody_sample&quot;</span>
    <span class="p">):</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="n">corrs</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">_1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">corrs</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">_2&quot;</span><span class="p">]</span>
        <span class="n">corrs</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrs</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">equal</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
        <span class="n">corrs</span> <span class="o">=</span> <span class="n">corrs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">suffixes</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/fh/fast/bloom_j/computational_notebooks/bdadonai/2022/vep_dms/SARS-CoV-2_Omicron_BA.1_spike_DMS_268C.59A/.snakemake/conda/bc6cf8719714f906f2c5affd1f05c658/lib/python3.9/site-packages/dms_variants/utils.py:360: FutureWarning: The default value of numeric_only in DataFrameGroupBy.corr is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">library</span><span class="p">,</span> <span class="n">library_corr</span> <span class="ow">in</span> <span class="n">corrs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;library&quot;</span><span class="p">):</span>
    <span class="n">corr_chart</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">library_corr</span><span class="p">)</span>
        <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;antibody_sample_1&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;antibody_sample_2&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;r2&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
            <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
                <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.3g&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;r2&quot;</span> <span class="k">else</span> <span class="n">c</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="s2">&quot;antibody_sample_1&quot;</span><span class="p">,</span> <span class="s2">&quot;antibody_sample_2&quot;</span><span class="p">,</span> <span class="s2">&quot;r2&quot;</span><span class="p">]</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">mark_rect</span><span class="p">(</span><span class="n">stroke</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">library</span><span class="p">)</span>
        <span class="o">.</span><span class="n">configure_axis</span><span class="p">(</span><span class="n">labelLimit</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">selections</span><span class="p">,</span> <span class="n">selection_names</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">censored_dropdown_selection</span><span class="p">,</span> <span class="s2">&quot;censored&quot;</span><span class="p">)</span>
    <span class="p">]:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;library&quot;</span><span class="p">:</span>
            <span class="n">corr_chart</span> <span class="o">=</span> <span class="n">corr_chart</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">corr_chart</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/fh/fast/bloom_j/computational_notebooks/bdadonai/2022/vep_dms/SARS-CoV-2_Omicron_BA.1_spike_DMS_268C.59A/.snakemake/conda/bc6cf8719714f906f2c5affd1f05c658/lib/python3.9/site-packages/altair/utils/core.py:317: FutureWarning: iteritems is deprecated and will be removed in a future version. Use .items instead.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div id="altair-viz-2c882241aafb488b904ace7151e833c3"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-2c882241aafb488b904ace7151e833c3") {
      outputDiv = document.getElementById("altair-viz-2c882241aafb488b904ace7151e833c3");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}, "axis": {"labelLimit": 500}}, "data": {"name": "data-dc9eb2aa26f5b7ce0b190ad394b878e3"}, "mark": {"type": "rect", "stroke": "black"}, "encoding": {"color": {"field": "r2", "scale": {"zero": true}, "type": "quantitative"}, "tooltip": [{"field": "library", "type": "nominal"}, {"field": "antibody_sample_1", "type": "nominal"}, {"field": "antibody_sample_2", "type": "nominal"}, {"field": "r2", "format": ".3g", "type": "quantitative"}], "x": {"field": "antibody_sample_1", "title": null, "type": "nominal"}, "y": {"field": "antibody_sample_2", "title": null, "type": "nominal"}}, "height": {"step": 15}, "params": [{"name": "parameter002", "select": {"type": "point", "fields": ["date"]}, "bind": {"input": "select", "options": [null, "2022-06-22"], "labels": ["all", "2022-06-22"], "name": "date"}}, {"name": "parameter003", "select": {"type": "point", "fields": ["antibody"]}, "bind": {"input": "select", "options": [null, "C68.59"], "labels": ["all", "C68.59"], "name": "antibody"}}, {"name": "parameter004", "select": {"type": "point", "fields": ["virus_batch"]}, "bind": {"input": "select", "options": [null, "thaw-1"], "labels": ["all", "thaw-1"], "name": "virus_batch"}}, {"name": "parameter008", "select": {"type": "point", "fields": ["censored"]}, "bind": {"input": "select", "options": [true, false], "name": "censored"}, "value": [{"censored": true}]}], "title": "Lib-2", "transform": [{"filter": {"param": "parameter002"}}, {"filter": {"param": "parameter003"}}, {"filter": {"param": "parameter004"}}, {"filter": {"param": "parameter008"}}], "width": {"step": 15}, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-dc9eb2aa26f5b7ce0b190ad394b878e3": [{"library": "Lib-2", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "r2": 1.0, "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "r2": 1.0, "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "r2": 0.021577363924780348, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "r2": 0.02365168111723779, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "r2": 0.021577363924780348, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "r2": 0.02365168111723779, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "r2": 1.0, "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-2", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "r2": 1.0, "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-2_2022-06-22_thaw-1_C68.59_1"}]}}, {"mode": "vega-lite"});
</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div id="altair-viz-39717847d6e24ba399a5991d75a2e8ec"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-39717847d6e24ba399a5991d75a2e8ec") {
      outputDiv = document.getElementById("altair-viz-39717847d6e24ba399a5991d75a2e8ec");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}, "axis": {"labelLimit": 500}}, "data": {"name": "data-ec16797cd58fe6a37880a7a607e58537"}, "mark": {"type": "rect", "stroke": "black"}, "encoding": {"color": {"field": "r2", "scale": {"zero": true}, "type": "quantitative"}, "tooltip": [{"field": "library", "type": "nominal"}, {"field": "antibody_sample_1", "type": "nominal"}, {"field": "antibody_sample_2", "type": "nominal"}, {"field": "r2", "format": ".3g", "type": "quantitative"}], "x": {"field": "antibody_sample_1", "title": null, "type": "nominal"}, "y": {"field": "antibody_sample_2", "title": null, "type": "nominal"}}, "height": {"step": 15}, "params": [{"name": "parameter002", "select": {"type": "point", "fields": ["date"]}, "bind": {"input": "select", "options": [null, "2022-06-22"], "labels": ["all", "2022-06-22"], "name": "date"}}, {"name": "parameter003", "select": {"type": "point", "fields": ["antibody"]}, "bind": {"input": "select", "options": [null, "C68.59"], "labels": ["all", "C68.59"], "name": "antibody"}}, {"name": "parameter004", "select": {"type": "point", "fields": ["virus_batch"]}, "bind": {"input": "select", "options": [null, "thaw-1"], "labels": ["all", "thaw-1"], "name": "virus_batch"}}, {"name": "parameter008", "select": {"type": "point", "fields": ["censored"]}, "bind": {"input": "select", "options": [true, false], "name": "censored"}, "value": [{"censored": true}]}], "title": "Lib-3", "transform": [{"filter": {"param": "parameter002"}}, {"filter": {"param": "parameter003"}}, {"filter": {"param": "parameter004"}}, {"filter": {"param": "parameter008"}}], "width": {"step": 15}, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-ec16797cd58fe6a37880a7a607e58537": [{"library": "Lib-3", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "r2": 1.0, "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "r2": 1.0, "antibody": "C68.59", "antibody_concentration": 20.2, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "r2": 0.034958555696923896, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "r2": 0.03488902348299141, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "r2": 0.04096493721834711, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "r2": 0.0418414275278652, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "r2": 0.034958555696923896, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "r2": 0.03488902348299141, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "r2": 1.0, "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "r2": 1.0, "antibody": "C68.59", "antibody_concentration": 323.2, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "r2": 0.02259706775559294, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "r2": 0.024264198056625972, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "r2": 0.04096493721834711, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_20.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "r2": 0.0418414275278652, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "r2": 0.02259706775559294, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_323.2_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "r2": 0.024264198056625972, "antibody": "C68.59", "antibody_concentration": null, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": false, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "r2": 1.0, "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}, {"library": "Lib-3", "censored": true, "antibody_sample_1": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "antibody_sample_2": "2022-06-22_thaw-1_antibody_C68.59_80.8_1", "r2": 1.0, "antibody": "C68.59", "antibody_concentration": 80.8, "virus_batch": "thaw-1", "date": "2022-06-22", "selection_group": "Lib-3_2022-06-22_thaw-1_C68.59_1"}]}}, {"mode": "vega-lite"});
</script></div>
</div>
</section>
</section>


          </div>
          
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;Bernadeta Dadonaite and Jesse Bloom (2022).
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/analyze_prob_escape.nblink.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>